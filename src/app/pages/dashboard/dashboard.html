<section class="min-h-[100svh] flex flex-col gap-4 ">
  <!-- Toolbar -->
  <div class="sticky top-0 z-30 bg-white/70 backdrop-blur border-b border-white/40">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center gap-3">
      <button
        class="p-2 rounded-lg hover:bg-slate-100"
        (click)="toggleAside()"
        aria-label="Open sidebar"
        aria-controls="app-aside"
        [attr.aria-expanded]="asideOpen()"
      >
        <svg class="w-5 h-5 text-slate-700" viewBox="0 0 24 24" fill="none">
          <path
            d="M3 6h18M3 12h18M3 18h18"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
          />
        </svg>
      </button>

      <img src="/assets/h_noname_logo.png" class="w-7 h-7 rounded-lg shadow mr-2" alt="" />
      <span class="font-semibold text-slate-900">ProjectHub</span>

      <!-- Search Box -->

      <div class="ml-auto relative w-full max-w-md">
        <label for="search" class="sr-only">Search</label>

        <!--ไอคอนอยู่ซ้ายในกล่อง -->
        <svg
          class="absolute left-2.5 sm:left-3 top-1/2 -translate-y-1/2 w-4 h-4 sm:w-5 sm:h-5 text-slate-400 pointer-events-none"
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="2"
          stroke="currentColor"
          aria-hidden="true"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M21 21l-4.35-4.35m0 0A7.5 7.5 0 104.5 4.5a7.5 7.5 0 0012.15 12.15z"
          />
        </svg>

        <input
          id="search"
          class="input !pl-10 sm:!pl-12 !pr-3 min-h-[42px] w-full"
          [value]="keyword()"
          (input)="keyword.set($any($event.target).value)"
          placeholder="Search projects..."
        />
      </div>

      <!-- แสดงรูปภาพโปรไฟล์และชื่อของผู้ใช้งานด้านหลัง Nav bar -->
      <!-- โปรไฟล์ขวาบน -->
<div class="ml-4 relative" (click)="$event.stopPropagation()">
  <button
    class="flex items-center gap-2 pl-2 pr-2 py-1 rounded-xl hover:bg-white/60 transition"
    (click)="toggleProfileMenu()"
    aria-haspopup="menu"
    [attr.aria-expanded]="profileOpen()"
  >
    <!-- <span class="text-sm font-semibold text-slate-900">Phakin K.</span> -->
    <img
      src="/assets/ph_profile.png"
      alt="Profile"
      class="w-8 h-8 rounded-full ring-1 ring-white/60"
    />
  </button>

  @if (profileOpen()) {
    <!-- Popover -->
    <div
      class="absolute right-0 top-full mt-2 w-72 rounded-2xl
             bg-white/80 backdrop-blur border border-white/40
             shadow-2xl z-[70] overflow-hidden"
      role="menu"
    >
      <!-- ส่วนหัว: รูป + ชื่อ + อีเมล -->
      <div class="p-4 flex items-center gap-3">
        <img src="/assets/ph_profile.png" alt="" class="w-12 h-12 rounded-full ring-1 ring-white/70" />
        <div class="min-w-0">
          <div class="font-semibold text-slate-900 truncate">Phakin Kamwilaisak</div>
          <div class="text-xs text-slate-500 truncate">s65524100xx@sau.ac.th</div>
        </div>
      </div>

      <!-- เส้นคั่น -->
      <div class="h-px bg-gradient-to-r from-transparent via-slate-200 to-transparent"></div>

      <!-- เมนู: Edit Profile / Logout -->
      <div class="p-2">
        <button
          class="w-full flex items-center gap-3 px-3 py-2 rounded-xl
                 hover:bg-slate-100/60 text-slate-700 transition"
          (click)="onEditProfile()"
        >
          <!-- icon: pencil -->
          <svg class="w-5 h-5 text-indigo-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
               stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 20h9"></path>
            <path d="M16.5 3.5a2.121 2.121 0 013 3L7 19l-4 1 1-4 12.5-12.5z"></path>
          </svg>
          <span class="text-sm font-medium">Edit Profile</span>
        </button>

        <button
          class="w-full flex items-center gap-3 px-3 py-2 rounded-xl
                 hover:bg-rose-50 text-rose-600 transition"
          (click)="onLogout()"
        >
          <!-- icon: logout -->
          <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
               stroke-linecap="round" stroke-linejoin="round">
            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
            <path d="M16 17l5-5-5-5"></path>
            <path d="M21 12H9"></path>
          </svg>
          <span class="text-sm font-medium">Logout</span>
        </button>
      </div>
    </div>
  }
</div>

    </div>
  </div>

  <!-- Actions bar (มินิมอล) -->
  <div class="max-w-6xl mx-auto w-full px-4 pt-10 mb-3">
    <div class="flex items-center gap-2">
      <!-- New Project = ปุ่มหลักแบบ gradient -->
      <button class="btn-primary-enhance" (click)="addQuick('New Project')">New Project</button>

      <!-- Delete Project = ปุ่มอ่อน โทน danger ให้เข้าธีม -->
      <button
        class="btn-ghost-enhance text-rose-600 border-rose-200 hover:bg-rose-50 hover:border-rose-300"
        (click)="removeManySelected()"
      >
        Delete Project
      </button>

      <!-- Export = ปุ่มรองโทน ghost ของธีม -->
      <button class="btn-ghost-enhance" (click)="exportCSV()">Export</button>
    </div>
  </div>

  <!-- Overlay -->
  <div
    class="fixed inset-0 z-40 bg-black/40 transition-opacity duration-300"
    [class.opacity-0]="!asideOpen()"
    [class.pointer-events-none]="!asideOpen()"
    (click)="asideOpen.set(false)"
  ></div>

  <!-- Drawer / Aside (แทรกเพิ่ม) -->
  <aside
    id="app-aside"
    class="fixed left-0 top-0 bottom-0 z-50 w-80 max-w-[85vw] glass-subtle border border-white/40 backdrop-blur-lg transition-transform duration-300 ease-out flex flex-col -translate-x-full"
    [class.translate-x-0]="asideOpen()"
    role="dialog"
    aria-label="Sidebar"
  >
    <!-- แถบสีซ้าย -->
    <span class="aside-accent" aria-hidden="true"></span>

    <!-- เมนู -->
    <div class="px-4 py-3 flex items-center gap-2 border-b border-white/40">
      <img src="/assets/h_noname_logo.png" class="w-6 h-6 rounded-lg" alt="" />
      <div class="font-semibold">Menu</div>
      <button
        class="ml-auto p-2 rounded-lg hover:bg-slate-100"
        (click)="asideOpen.set(false)"
        aria-label="Close sidebar"
      >
        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none">
          <path
            d="M6 6l12 12M18 6l-12 12"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
          />
        </svg>
      </button>
    </div>

    <!-- รายการไอเท็มที่แสดงบนแถบด้านซ้าย -->
    <nav class="p-3 space-y-1 text-sm font-medium">
      <a routerLink="/dashboard" class="menu-item">
        <svg
          class="w-5 h-5 text-indigo-500"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          viewBox="0 0 24 24"
        >
          <path d="M3 12l9-9 9 9M4 10v10a1 1 0 001 1h14a1 1 0 001-1V10" />
        </svg>
        Dashboard
      </a>

      <a routerLink="/projects" class="menu-item">
        <svg
          class="w-5 h-5 text-cyan-500"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          viewBox="0 0 24 24"
        >
          <path d="M9 12h6M9 16h6M4 6h16M4 6v12a2 2 0 002 2h12a2 2 0 002-2V6" />
        </svg>
        Recently Used
      </a>

      <a routerLink="/settings" class="menu-item">
        <svg
          class="w-5 h-5 text-indigo-400"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          viewBox="0 0 24 24"
        >
          <path d="M12 8a4 4 0 100 8 4 4 0 000-8z" />
          <path
            d="M2.458 12C3.732 7.943 7.523 5 12 5c4.477 0 8.268 2.943 9.542 7-.002.02-.002.04 0 .06C20.268 16.057 16.477 19 12 19c-4.477 0-8.268-2.943-9.542-7-.002-.02-.002-.04 0-.06z"
          />
        </svg>
        Favorite Project
      </a>
    </nav>

    <div class="mt-auto p-3 text-xs text-slate-500">© ProjectHub</div>
  </aside>

  <!-- คอนเทนต์รายการ -->
  <div class="max-w-6xl mx-auto px-4 w-full space-y-3">
    @if (filtered().length === 0) {
    <div class="text-slate-500 text-sm p-6">No projects found.</div>
    } @else { @for (p of paged(); track p.id) {
    <div
      class="relative bg-white/80 backdrop-blur border border-white/30 rounded-xl px-4 py-3 flex items-center gap-3"
      [class.z-50]="menuOpenId() === p.id"
    >
      <input
        type="checkbox"
        [checked]="isChecked(p.id)"
        (change)="toggleCheck(p.id, $any($event.target).checked)"
      />

      <div class="flex-1 px-3">
        <div class="font-medium text-slate-900 mb-2">{{ p.name }}</div>
        <div class="text-xs text-slate-500">
          Last modified: {{ p.updatedAt | date : 'mediumDate' }} &nbsp; {{ p.tables }} tables
        </div>
      </div>

      <!-- ปุ่ม favorite project -->
      <button
        class="p-2 rounded-lg hover:bg-slate-100"
        title="Favorite"
        (click)="toggleFavorite(p.id)"
      >
        <svg
          class="w-5 h-5"
          viewBox="0 0 24 24"
          fill="currentColor"
          [attr.fill]="p.favorite ? 'currentColor' : 'none'"
          [attr.stroke]="p.favorite ? 'currentColor' : 'currentColor'"
        >
          <path
            d="M12 17.3l-6.2 3.3 1.2-6.7L2 8.9l6.9-1 3.1-6.2 3.1 6.2 6.9 1-5 5 1.2 6.7z"
            stroke-width="2"
          ></path>
        </svg>
      </button>

      <!-- Kebab menu -->
      <div class="relative">
        <button
          class="p-2 rounded-lg hover:bg-slate-100"
          aria-haspopup="menu"
          [attr.aria-expanded]="menuOpenId() === p.id"
          (click)="$event.stopPropagation(); toggleMenu(p.id)"
        >
          <!-- three-dots vertical -->
          <svg
            class="w-5 h-5 text-slate-700"
            viewBox="0 0 24 24"
            fill="currentColor"
            aria-hidden="true"
          >
            <circle cx="12" cy="5" r="1.8"></circle>
            <circle cx="12" cy="12" r="1.8"></circle>
            <circle cx="12" cy="19" r="1.8"></circle>
          </svg>
        </button>

        <!-- click kebab เปิดดู menu -->

        @if (menuOpenId() === p.id) {
        <div
          class="absolute right-0 top-full mt-2 min-w-[11rem] rounded-xl border border-slate-200 bg-white shadow-2xl z-[60] overflow-hidden translate-x-2"
          (click)="$event.stopPropagation()"
          role="menu"
        >
          <button
            class="w-full text-left px-3 py-2 text-sm hover:bg-slate-50"
            (click)="openProject(p.id)"
          >
            Open project
          </button>
          <button
            class="w-full text-left px-3 py-2 text-sm hover:bg-slate-50"
            (click)="renameProject(p.id, p.name)"
          >
            Rename
          </button>
          <button
            class="w-full text-left px-3 py-2 text-sm text-rose-600 hover:bg-rose-50"
            (click)="removeOne(p.id)"
          >
            Delete
          </button>
        </div>
        }
      </div>
    </div>
    } }
  </div>

  <!-- Pagination bar -->
<div #pagerZone class="max-w-6xl mx-auto px-4 mt-6 mb-10">
  <div class="flex flex-col sm:flex-row sm:items-center gap-3 sm:gap-4">
    <!-- Summary -->
    <div class="text-xs sm:text-sm text-slate-600">
      Showing
      {{ pageIndex() * pageSize + (filtered().length ? 1 : 0) }}
      –
      {{ Math.min((pageIndex() + 1) * pageSize, filtered().length) }}
      of
      {{ filtered().length }}
    </div>

    <!-- Controls -->
    <div class="sm:ml-auto flex items-center gap-1">
      <button
        class="px-3 py-2 rounded-xl border border-slate-200 bg-white/70 hover:bg-white
               text-slate-700 disabled:opacity-50 disabled:pointer-events-none transition"
        (click)="prevPage()"
        [disabled]="pageIndex() === 0"
        aria-label="Previous"
      >
        ‹ Prev
      </button>

      <!-- page numbers (ซ่อนไปในจอแคบ, โชว์จอกว้าง) -->
      <div class="hidden sm:flex items-center gap-1">
        @for (n of pages(); track n) {
          <button
            (click)="gotoPage(n)"
            [ngClass]="{
              'bg-gradient-to-r from-indigo-600 to-cyan-500 text-white':
                pageIndex() === n,
              'bg-white/70 text-slate-700 hover:bg-white border border-slate-200':
                pageIndex() !== n
            }"
            class="px-3 py-2 rounded-xl transition"
            aria-label="Go to page {{ n + 1 }}"
          >
            {{ n + 1 }}
          </button>
        }
      </div>

      <button
        class="px-3 py-2 rounded-xl border border-slate-200 bg-white/70 hover:bg-white
               text-slate-700 disabled:opacity-50 disabled:pointer-events-none transition"
        (click)="nextPage()"
        [disabled]="pageIndex() >= pageCount() - 1"
        aria-label="Next"
      >
        Next ›
      </button>
    </div>
  </div>
</div>

</section>
